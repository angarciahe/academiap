<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Subir Archivos o Carpetas a Firebase</title>
</head>
<body>
  <h2>Subir archivos o carpetas a Firebase Storage</h2>

  <label for="categoria">Categor√≠a:</label>
  <select id="categoria">
    <option value="Archivos_pdf">Archivos_pdf</option>
    <option value="Imagenes">Imagenes</option>
    <option value="Datos_brutos">Datos_brutos</option>
  </select>

  <label for="subcategoria">Subcategor√≠a:</label>
  <select id="subcategoria">
    <option value="Cancer">C√°ncer</option>
    <option value="Diabetes">Diabetes</option>
    <option value="Control">Control</option>
  </select>

  <br><br>
  <label for="fileInput">Elegir archivos:</label>
  <input type="file" id="fileInput" multiple />

  <br>
  <label for="folderInput">O elegir una carpeta:</label>
  <input type="file" id="folderInput" webkitdirectory directory multiple />

  <br><br>
  <button onclick="upload()">Subir</button>

  <p id="status"></p>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-storage-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>

  <script>
    // üîß Configuraci√≥n de Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyDmb0Q2MUkeKgWpS2qbF3ttdHNfc07kID4",
  	authDomain: "academiap-project.firebaseapp.com",
  	projectId: "academiap-project",
  	storageBucket: "academiap-project.firebasestorage.app",
  	messagingSenderId: "582873937137",
  	appId: "1:582873937137:web:dd34fc0de21e95aedee550",
  	measurementId: "G-M24E4VXELD"
    };

    firebase.initializeApp(firebaseConfig);
    const storage = firebase.storage();

    // Login an√≥nimo
    firebase.auth().signInAnonymously().catch(console.error);

    function upload() {
      const categoria = document.getElementById('categoria').value;
      const subcategoria = document.getElementById('subcategoria').value;
      const basePath = `uploads/${categoria}/${subcategoria}/`;

      // Obtener archivos del input de archivos o carpeta
      const fileInput = document.getElementById('fileInput');
      const folderInput = document.getElementById('folderInput');

      const files = folderInput.files.length > 0 ? folderInput.files : fileInput.files;

      if (!files.length) {
        document.getElementById('status').innerText = "Selecciona archivos o una carpeta.";
        return;
      }

      let total = files.length;
      let uploaded = 0;

      Array.from(files).forEach(file => {
        const path = file.webkitRelativePath
          ? basePath + file.webkitRelativePath
          : basePath + file.name;

        const storageRef = storage.ref(path);

        storageRef.put(file).then(() => {
          uploaded++;
          document.getElementById('status').innerText = `Subiendo... ${uploaded}/${total}`;

          if (uploaded === total) {
            document.getElementById('status').innerText = `‚úÖ Subida completa: ${total} archivos.`;
          }
        }).catch(err => {
          console.error("Error al subir", file.name, err);
        });
      });
    }
  </script>
</body>
</html>
